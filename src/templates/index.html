<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
</head>

<body>
    <div class="container-fluid">
        <div class="row">       
            <div class="col-3 bg-light" id="left">   
                <div class="list-group">
                    <button id="device" class="list-group-item btn btn-outline-dark mt-5"><span class="fa fa-desktop"></span> Device</button>
                    <button id="download" class="list-group-item btn btn-outline-dark mt-2"><span class="fa fa-download"></span> Download</button>
                    <button id="map" class="list-group-item btn btn-outline-dark mt-2"><span class="fa fa-map-marker"></span> Map Tracker</button>
                    <button id="settings" class="list-group-item btn btn-outline-dark mt-2"><span class="fa fa-cogs"></span> Settings</button>
                </div>
            </div>

			<div class="col-8 mt-3 pt-2">

				<form class="row">
					<div class="col-3 form-group">
						<select id="port" class="form-control">
							<option>COM 1</option>
							<option>COM 2</option>
							<option>COM 3</option>
						</select>
					</div>
					<div class="col-4 form-group">
						<button class="btn btn-outline-secondary">Connect <span class="fa fa-plug"></span></button>
					</div>

					<div class="col-4 ml-3 form-group">
						<button id="setup" class="btn btn-secondary"><span class="fa fa-cog"></span> Device Setup</button>
					</div>
				</form>
				<div class="dropdown-divider mt-1 mb-1"></div>
				<div class="row">
					<div class="col-8">
						<div class="row">
							<div class="col-6">
								<div class="input-group mb-2">
									<div class="input-group-prepend">
									  <div class="input-group-text"><span class="fa fa-calendar"></span></div>
									</div>
									<input type="text" class="form-control" id="date" placeholder="Date" disabled>
								  </div>
							</div>
							<div class="col-6">
								<div class="input-group mb-2">
									<div class="input-group-prepend">
									  <div class="input-group-text"><span class="fa fa-clock-o"></span></div>
									</div>
									<input type="text" class="form-control" id="time" placeholder="Time" disabled>
								  </div>
							</div>
						</div>
						<div class="row mt-2">
							<div class="col-6">
								<div class="input-group mb-2">
									<div class="input-group-prepend">
									  <div class="input-group-text"><span class="fa fa-arrow-up"></span></div>
									</div>
									<input type="text" class="form-control" id="latitude" placeholder="Latitude" disabled>
								  </div>
							</div>
							<div class="col-6">
								<div class="input-group mb-2">
									<div class="input-group-prepend">
									  <div class="input-group-text"><span class="fa fa-arrow-right"></span></div>
									</div>
									<input type="text" class="form-control" id="longitude" placeholder="Longitude" disabled>
								  </div>
							</div>
						</div>
						<div class="row mt-2">
							<div class="col-6">
								<div class="input-group mb-2">
									<div class="input-group-prepend">
									  <div class="input-group-text"><small>*</small></div>
									</div>
									<input type="text" class="form-control" id="hdop" placeholder="HDOP" disabled>
								  </div>
							</div>
							<div class="col-6">
								<div class="input-group mb-2">
									<div class="input-group-prepend">
									  <div class="input-group-text"><span class="fa fa-spinner"></span></div>
									</div>
									<input type="text" class="form-control" id="speed" placeholder="Speed" disabled>
								  </div>
							</div>
						</div>
					</div>
					<div class="col-4">
						<div class="row">
							<div class="col-4">
								<span class="fa fa-laptop fa-4x"></span>
							</div>
							<div class="col-12">
								<small class="text-muted">RTK</small>
								<p class="text-muted">Rover SN: 12345</p>
							</div>
						</div>
						<div class="row">
							
						</div>
					</div>
				</div>

				<div class="row mt-2">
					<div class="col-4">
						<div class="input-group mb-2">
							<div class="input-group-prepend">
							  <div class="input-group-text">@</div>
							</div>
							<input type="text" class="form-control" id="rtkStatus" placeholder="RTK Status" disabled>
						  </div>
					</div>
					<div class="col-4">
						<div class="input-group mb-2">
							<div class="input-group-prepend">
							  <div class="input-group-text">#</div>
							</div>
							<input type="text" class="form-control" id="rtkAge" placeholder="RTK Age" disabled>
						  </div>
					</div>
					<div class="col-4">
						<div class="input-group mb-2">
							<div class="input-group-prepend">
							  <div class="input-group-text">:</div>
							</div>
							<input type="text" class="form-control" id="rtkRatio" placeholder="RTK Ratio" disabled>
						  </div>
					</div>
				</div>

				<div class="dropdown-divider mt-3 mb-3"></div>

				<div class="row">
					<div class="col">
						<h5>Live Data Feed</h5>
						<div class="list-group" style="height: 200px; overflow: scroll;">
							<li id="test" class="text-muted">$ some data</li>
							<li class="text-muted">$ some data</li>
							<li class="text-muted">$ some data</li>
							<li class="text-muted">$ some data</li>
							<li class="text-muted">$ some data</li>
							<li class="text-muted">$ some data</li>
							<li class="text-muted">$ some data</li>
							<li class="text-muted">$ some data</li>
							<li class="text-muted">$ some data</li>
							<li class="text-muted">$ some data</li>
							<li class="text-muted">$ some data</li>
							<li class="text-muted">$ some data</li>
						</div>
					</div>
				</div>
			</div>
        </div>
    </div>

	<script>
		const { ipcRenderer } = require('electron');

		//Menu selectors
		document.querySelector('#device').addEventListener('click', (event) => {
			ipcRenderer.send('open:device');
		});
		document.querySelector('#download').addEventListener('click', (event) => {
			ipcRenderer.send('open:download');
		});
		document.querySelector('#map').addEventListener('click', (event) => {
			ipcRenderer.send('open:map');
		});
		document.querySelector('#settings').addEventListener('click', (event) => {
			ipcRenderer.send('open:settings');
		});

		//Device setup
		document.querySelector('#setup').addEventListener('click', (event) => {
			ipcRenderer.send('device:setup');
		});

		// receiving nmea file
		ipcRenderer.on('read:file', (event, fileContent) => {
			document.querySelector('#test').innerHTML = `${fileContent}`;
		});

		// receiving parsed nmea file
		ipcRenderer.on('parse:nmea', (event, sentence) => {

			var nmea = sentence.split(",");
			var time = nmea[1].substring(0,2) + ":" + nmea[1].substring(2,4) + ":" + nmea[1].substring(4,6);
			var date = nmea[9].substring(0,2) + "/" + nmea[9].substring(2,4) + "/" + nmea[9].substring(4,6);
			var speed = nmea[7] + " knots";
		    var status = (nmea[2] == "A" ? "Ok!" : "Warning");

		    var latDeg = parseInt(nmea[3].substring(0, 2));
		    var latMin = nmea[3].substring(2);
		    var lat = latDeg + (latMin/60);
		    var latDirection = nmea[4];

		    var lngDeg = parseInt(nmea[5].substring(0, 3));
		    var lngMin = nmea[5].substring(3);
		    var lng = lngDeg + (lngMin/60);
		    var lngDirection = nmea[6];

		    document.querySelector('#latitude').value = lat;
			document.querySelector('#longitude').value = lng;
			document.querySelector('#hdop').value = lngDirection;
			document.querySelector('#speed').value = speed;
			document.querySelector('#time').value = time;
			document.querySelector('#date').value = date;
		});

	</script>

</body>